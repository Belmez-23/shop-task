# Проект shop-task

Является решением тестового задания

Представляет из себя API, который сохраняет покупателей, товары и заказы. Используется *PHP 8.2*, фреймворк *Symfony 7*, база данных на *MySQL*.

## Задание

Необходимо создать endpoint API интернет-магазина, с помощью которого можно оформить заказ товаров.

Список обязательных сущностей и их полей:
- goods - id, name, price (цена за единицу), count (кол-во доступных единиц на складе);
- users – id, name;

Все остальные/вспомогательные сущности и схема БД проектируется на усмотрение кандидата (в частности, таблица с заказами).

Если всех товаров хватает на складе — необходимо оформить заказ, вернуть id заказа. Если каких-то товаров не хватает - не оформлять ничего, вернуть user-friendly ответ с текстом «Товаров не хватает на складе, заказ не будет оформлен».

Предусмотреть, что нагрузка на сервис может расти - пользователи могут покупать одни и те же товары одновременно (ориентир от 10 до 50 запросов в секунду), при этом, скорость обработки API-запросов не должна разительно увеличиваться при большом количестве разных товаров на складе (до 100000), и большого количества разных товаров в одном заказе (до 100), а так же не должно быть ошибок в логике оформления товаров.

## Развёртка проекта
В проекте настроены Docker-контейнеры, поднять их можно командой `make docker-local`

Для создания базы данных и таблиц потребуется выполнить миграции `php bin/console doctrine:migrations:migrate`

## Тестирование

Командой `php vendor/bin/codecept run` вы можете запустить автотесты, которые включают в себя добавление товаров, пользователей и заказов. Предусмотрена эмуляция нагрузки на API, например создание нескольких десятков заказов или заказов на сотню товаров.

## API 
По условиям задачи проект требует реализацию добавления заказа, который состоит из покупателя и товаров. Для этого создан маршрут:

`[POST] /api/order`
Запрос на создание заказа. Принимает JSON-тело:
```
{
    "userId": {{ ID покупателя }},
    "goods": [
      {
          "id": {{ ID товара }}
          "count": {{ Количество }}
      },
      ...
    ]
}
```

_Замечу, что данный формат JSON-тела был условием ТЗ. Поэтому в этом проекте под user понимается отдельная сущность Покупатель, но никак не Пользователь API. При более гибких условиях уместнее было бы реализовать авторизацию пользователя и использование пароля или токена во время запросов к API_

Предусмотрена валидация заказа. Оформление не произойдёт, если возникнет ошибка, например, указан несуществующий покупатель или товара на складе не хватает.

Чтобы добавить важные для заказа сущности, а именно товар и покупателя были также созданы маршруты:

`[POST] /api/goods`
Запрос на создание товара. Принимает JSON-тело:
```
{
    "title": {{ Наименование }},
    "price": {{ Цена }},
    "count": {{ Количество на складе }}
}
```

`[POST] /api/user`
Запрос на создание покупателя. Принимает JSON-тело:
```
{
    "firstName": {{ Имя }},
    "lastName": {{ Фамилия }}
}
```
